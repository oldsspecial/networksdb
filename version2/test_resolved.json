{
  "schema_version": "2.0",
  "canonical_storage_format": {
    "node": {
      "description": "Canonical storage format for node instances",
      "required_fields": [
        "primary_label",
        "node_id",
        "labels",
        "properties",
        "identifying_properties"
      ],
      "optional_fields": [],
      "schema": {
        "primary_label": {
          "type": "string",
          "description": "From schema definition"
        },
        "node_id": {
          "type": "string",
          "description": "Computed via SHA1+Base85"
        },
        "labels": {
          "type": "list",
          "description": "All labels including primary_label"
        },
        "properties": {
          "type": "dict",
          "description": "Regular (non-identifying) property values"
        },
        "identifying_properties": {
          "type": "dict",
          "description": "Identifying property values"
        }
      }
    },
    "relationship": {
      "description": "Canonical storage format for relationship instances",
      "required_fields": [
        "rel_type",
        "rel_id",
        "properties",
        "identifying_properties",
        "start_node",
        "end_node"
      ],
      "optional_fields": [],
      "schema": {
        "rel_type": {
          "type": "string",
          "description": "From schema definition"
        },
        "rel_id": {
          "type": "string",
          "description": "Computed via SHA1+Base85"
        },
        "properties": {
          "type": "dict",
          "description": "Regular (non-identifying) property values"
        },
        "identifying_properties": {
          "type": "dict",
          "description": "Identifying property values"
        },
        "start_node": {
          "type": "dict",
          "description": "Start node with primary_label and node_id",
          "required_fields": [
            "primary_label",
            "node_id"
          ]
        },
        "end_node": {
          "type": "dict",
          "description": "End node with primary_label and node_id",
          "required_fields": [
            "primary_label",
            "node_id"
          ]
        }
      }
    }
  },
  "indexes": {
    "constraints": [
      {
        "name": "server_node_id_key",
        "type": "key",
        "labels": [
          "Server"
        ],
        "properties": [
          "node_id"
        ],
        "schema_type": "node"
      },
      {
        "name": "person_node_id_key",
        "type": "key",
        "labels": [
          "Person"
        ],
        "properties": [
          "node_id"
        ],
        "schema_type": "node"
      },
      {
        "name": "owns_rel_id_key",
        "type": "key",
        "labels": [
          "OWNS"
        ],
        "properties": [
          "rel_id"
        ],
        "schema_type": "relationship"
      }
    ],
    "indexes": []
  },
  "nodes": {
    "Server": {
      "primary_label": "Server",
      "labels": [
        "Server"
      ],
      "entity_version": "1.0.0",
      "extends": "Timestamped",
      "optional_labels": [
        "Active",
        "Inactive",
        "Production",
        "Development"
      ],
      "description": "Server infrastructure",
      "properties": {
        "created_at": {
          "type": "datetime",
          "identifying": false,
          "required": false,
          "merge_strategy": "min",
          "description": "Creation timestamp"
        },
        "updated_at": {
          "type": "datetime",
          "identifying": false,
          "required": false,
          "merge_strategy": "max",
          "description": "Last update timestamp"
        },
        "count": {
          "type": "integer",
          "identifying": false,
          "required": false,
          "merge_strategy": "sum"
        },
        "hostname": {
          "type": "string",
          "identifying": true,
          "required": true,
          "normalize": [
            "trim",
            "lowercase"
          ],
          "constraints": {
            "min_length": 1,
            "max_length": 63,
            "pattern": "^[a-z0-9-]+$"
          },
          "description": "Server hostname"
        },
        "ip_address": {
          "type": "string",
          "identifying": false,
          "required": false,
          "normalize": [
            "trim"
          ],
          "constraints": {
            "pattern": "^\\d{1,3}(\\.\\d{1,3}){3}$"
          },
          "merge_strategy": "take_last",
          "description": "IP address"
        },
        "datacenter": {
          "type": "string",
          "identifying": false,
          "required": false,
          "normalize": [
            "trim"
          ],
          "merge_strategy": "take_last",
          "description": "Datacenter location"
        },
        "status": {
          "type": "string",
          "identifying": false,
          "required": false,
          "normalize": [
            "trim",
            "lowercase"
          ],
          "constraints": {
            "enum": [
              "active",
              "inactive",
              "maintenance"
            ]
          },
          "merge_strategy": "take_last",
          "description": "Server status"
        }
      },
      "identifying_properties": [
        "hostname"
      ],
      "regular_properties": [
        "count",
        "created_at",
        "datacenter",
        "ip_address",
        "status",
        "updated_at"
      ]
    },
    "Person": {
      "primary_label": "Person",
      "labels": [
        "Person"
      ],
      "entity_version": "1.0.0",
      "extends": "Timestamped",
      "optional_labels": [
        "Owner",
        "Admin",
        "User"
      ],
      "description": "Person entity",
      "properties": {
        "created_at": {
          "type": "datetime",
          "identifying": false,
          "required": false,
          "merge_strategy": "min",
          "description": "Creation timestamp"
        },
        "updated_at": {
          "type": "datetime",
          "identifying": false,
          "required": false,
          "merge_strategy": "max",
          "description": "Last update timestamp"
        },
        "count": {
          "type": "integer",
          "identifying": false,
          "required": false,
          "merge_strategy": "sum"
        },
        "name": {
          "type": "string",
          "identifying": true,
          "required": true,
          "normalize": [
            "trim"
          ],
          "description": "Person name"
        },
        "email": {
          "type": "string",
          "identifying": false,
          "required": false,
          "normalize": [
            "trim",
            "lowercase"
          ],
          "constraints": {
            "pattern": "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
          },
          "merge_strategy": "take_first",
          "description": "Email address"
        }
      },
      "identifying_properties": [
        "name"
      ],
      "regular_properties": [
        "count",
        "created_at",
        "email",
        "updated_at"
      ]
    }
  },
  "relationships": {
    "OWNS": {
      "rel_type": "OWNS",
      "description": "Person owns a server",
      "properties": {
        "since": {
          "type": "datetime",
          "identifying": false,
          "required": false,
          "merge_strategy": "min",
          "description": "Ownership start date"
        }
      },
      "identifying_properties": [],
      "regular_properties": [
        "since"
      ]
    }
  }
}